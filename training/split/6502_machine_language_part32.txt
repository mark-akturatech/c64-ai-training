# ML for C64 - Appendix C: Plus/4 Memory Map Continued

                                                                        :196:

"TED" Chip, Preliminary
-----------------------

[again, it's pretty difficult to see the exact bit boundaries between the
 fields, so this may be off by a bit or two. :( -wf ]

      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF00 |                                                       Low Byte| 65280
      +- - - - - - - - - - - - - - Timer 1 - - - - - - - - - - - - - -+
$FF01 |                                                      High Byte| 65281
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF02 |                                                       Low Byte| 65282
      +- - - - - - - - - - - - - - Timer 2 - - - - - - - - - - - - - -+
$FF03 |                                                      High Byte| 65283
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF04 |                                                       Low Byte| 65284
      +- - - - - - - - - - - - - - Timer 3 - - - - - - - - - - - - - -+
$FF05 |                                                      High Byte| 65285
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF06 | Test  |  ECM  |  BMM  | Blank | Rows  |       X-Adjust        | 65286
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF07 |Rus Off|  PAL  |Freeze |  MCM  |Columns|       Y-Adjust        | 65287
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF08 |                        Keyboard Latch                         | 65288
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF09 |IRQFlag|Timer 3|///////|Timer 2|Timer 1|LightPn|Raster |///////| 65289
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF0A |IER:   |Timer 3|///////|Timer 2|Timer 1|LightPn|Raster |       | 65290
      +-------+-------+-------+-------+-------+-------+-------+- - - -+
$FF0B |                              RC                               | 65291
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF0C |///////////////////////////////////////////////|               | 65292
      +-------+-------+-------+-------+-------+-------+- - - - - - - -+
$FF0D |                              CUR                              | 65293
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF0E |                            Voice 1                    Low Byte| 65294
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF0F |                            Voice 2                    Low Byte| 65295
      +-------+-------+-------+-------+-------+-------+- - - - - - - -+
$FF10 |///////////////////////////////////////////////|      High Bits| 65296
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF11 |         Sound Select          |            Volume             | 65297
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF12 |///////////////|         BMB           | RBANK |Voice 1    High| 65298
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF13 |                    Character Base             |SCLOCK |STATUS | 65299
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF14 |                 Video Matrix          |///////////////////////| 65300
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF15 |///////|       Luminance       |             Color            0| 65301
      +-------+- - - - - - - - - - - - - - - - - - - - - - - - - - - -+
$FF16 |///////|                       |                              1| 65302
      +-------+- - - - - - - - - Background  - - - - - - - - - - - - -+
$FF17 |///////|                                                      2| 65303
      +-------+- - - - - - - - -    Colors   - - - - - - - - - - - - -+
$FF18 |///////|                       |                              3| 65304
      +-------+- - - - - - - - - - - - - - - - - - - - - - - - - - - -+
$FF19 |///////|                       |                              4| 65305
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF1A |///////////////////////////////////////////////|               | 65306
      +-------+-------+-------+-------+-------+-------+- - - - - - - -+
$FF1B |                              BRE                              | 65307
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF1C |///////////////////////////////////////////////////////|       | 65308
      +-------+-------+-------+-------+-------+-------+-------+- - - -+
$FF1D |                              VL                               | 65309
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF1E |                               H                               | 65310
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF1F |///////|              BL               |         VSUB          | 65311
      +-------+-------+-------+-------+-------+-------+-------+-------+
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF3E |                          ROM Select                           | 65342
      +-------+-------+-------+-------+-------+-------+-------+-------+
$FF3F |                          RAM Select                           | 65343
      +-------+-------+-------+-------+-------+-------+-------+-------+

Figure C.13

                                                                       :197:

B-Series (B-128, CBM-256, etc.)
===============================


The Great Zero-Page Hunt
------------------------

Zero page has a different meaning on the B series.  There are several zero
pages.  Usually, you'll want to use values from bank 15 (the ROM bank, where
system variables are kept); but if you are writing programs that will reside
in a different bank, you'll have all of zero page (except locations 0 and 1)
completely at your disposal.

If you need space in bank 15 zero page, you'll need to do some looking
around.  Addresses $E6 to $FF are not used by the system.  Locations $20 to
$2B and $64 to $6E are work areas available for temporary use.

Most zero-page locations may be copied to another part of memory so that
their original contents can be restored after use.  The programmer should
take great care, however, in modifying the following locations, which are
critical within the operating system or BASIC:  $1A, $1D to $1F, $2D to $41,
$43, $5B, $78, $85 to $87, $9E to $AB, $C0 to $E5.


Memory Map
----------

The following information applies to B systems released after April 1983,
which contain a revised machine language monitor.  (If POKE 6,0:SYS 6 doesn't
bring in a monitor display complete with a "period" prompt, you have an
incompatible version.)

Notable features as compared to previous Commodore products include:

 - CHRGOT is no longer in RAM.  Wedge-type coding must be inserted at links
   $029E and $02A0, which is likely to make the job easier.

 - BASIC vectors have "split."  Now, for example, there are discrete "start
   of variables" and "end of variables," distinct from end-of-BASIC and
   start-of-arrays.  Three-byte vectors (including bank number) are not
   uncommon.

 - The "jump table" at the top of memory is still accessible and reasonably
   consistent with previous Commodore products.

 - Simple machine language programs will fit into the spare 1K of RAM at
   $0400 to $07FF without trouble.  Large programs must be implemented either
   by plug-in memory (RAM or ROM) in bank 15 or by being placed into another
   bank (preferably bank 3).  Supplementary code will be needed to make all
   the coding components fit.

                                                                        :198:

The following map contains BASIC addresses specific to the B256/80;
references to banks 0 and 4 are also specific to that machine.  Most of the
map is of general usage, however.


Hex         Decimal       Description
-------------------------------------------------------------------

-All Banks:
0000            0         6509 execution register
0001            1         6509 indirection register

-Bank 0:  Unused

-Bank 1:
0002-F000       2-61439   BASIC program (text) RAM
FA5E-FB00   61440-64512   Input buffer area

-B256 Bank 2:
0002-FFFF       2-65535   BASIC arrays in RAM

-B128 Bank 2:
0002-FFFF       2-65535   BASIC variables, arrays and strings;
                          KEY definitions

-B256 Bank 3:
0002-7FFF       2-32767   Unused RAM
8000-FFFF   32768-65535   BASIC variables in RAM

-B256 Bank 4:
0002-FBFF       2-64511   BASIC strings (top down) in RAM
FC00-FCFF   64512-64767   Unused RAM (descriptors?)
FD00-FFFF   64768-65535   Current KEY definitions

-Banks 5 to 14:  Unused.

-Bank 15:
0002-0004       2-4       USR jump
0005-0008       5-8       TI$ output elements:  Hours, Mins, Secs, Tenths
0009-000B       9-11      PRINT USING format pointer
000C           12         Search character
000D           13         Scan-between-quotes flag
000E           14         Input point; number of subscripts
000F           15         Catalog line counter
0010           16         Default DIM flag
0011           17         Type:  $FF = string; $00 = integer

                                                                        :199:

0012           18         Type:  $80 = integer; $00 = floating point
0013           19         Crunch flag
0014           20         Subscript index
0015           21         INPUT = 0; GET = 64; READ = 152
0016-0019      22-25      Disk status work values
001A           26         Current I/O device for prompt suppress
001B-001C      27-28      Integer value
001D-001F      29-31      Descriptor stack pointers
0020-002B      32-43      Miscellaneous work pointers
002C           44         [unused?  -wf]
002D-002E      45-46      Start-of-BASIC pointer
002F-0030      47-48      End-of-BASIC pointer
0031-0032      49-50      Start-of-Variables pointer
0033-0034      51-52      End-of-Variables pointer
0035-0036      53-54      Start-of-Arrays pointer
0037-0038      55-56      End-of-Arrays pointer
0039-003A      57-58      Variable work pointer
003B-003C      59-60      Bottom-of-Strings pointer
003D-003E      61-62      Utility string pointer
003F-0041      63-65      Top of string memory pointer
0042-0043      66-67      Current BASIC line number
0044-0045      68-69      Previous BASIC line number
0046-0047      70-71      Previous BASIC text pointer
0048           72         [unused?  -wf]
0049-004A      73-74      Data line pointer
004B-004C      75-76      Data text pointer
004D-004E      77-78      Input pointer
004F-0050      79-80      Variable name
0051-0053      81-83      Variable address
0054-0056      84-86      For-loop pointer
0057-0058      87-88      Text pointer save
0059           89         [unused?  -wf]
005A           90         Comparison symbol accumulator
005B-005D      91-93      Function location
005E-0060      94-96      Working string vector
0061-0063      97-99      Function jump code
0064-006E     100-110     Work pointers, values
006F          111         Exponent sign
0070          112         Accumulator string prefix
0071          113         Accumulator #1:  exponent
0072-0075     114-117     Accumulator #1:  mantissa
0076          118         Accumulator #1:  sign

                                                                        :200:

0077          119         Series evaluation constant pointer
0078          120         Accumulator #1:  high-order (overflow)
0079          121         Accumulator #2:  exponent
007A-007D     122-125     Accumulator #2:  mantissa
007E          126         Accumulator #2:  sign
007F          127         Sign comparison:  Accumulator #1 vs #2
0080          128         Accumulator #1:  low-order (rounding)
0081-0084     129-132     Series; work pointers
0085-0087     133-135     BASIC text pointer
0088-0089     136-137     Input pointer
008B-008E     139-142     DOS parser work values
008F          143         Error type number
0090-0092     144-146     Pointer to filename
0093-0095     147-149     Pointer:  tape buffer; scrolling
0096-0098     150-152     Load end address; end of program
0099-009B     153-155     I/O start address
009C          156         Status word ST
009D          157         Filename length
009E          158         Current logical file
009F          159         Current device
00A0          160         Current secondary address
00A1          161         Input device, normally 0
00A2          162         Output CMD device, normally 3
00A3-00A5     163-165     [unused?  -wf]
00A6-00A8     166-168     INBUF
00A9          169         Keyswitch PIA:  STOP key, etc.
00AA          170         IEEE deferred flag
00AB          171         IEEE deferred character
00AC-00AD     172-173     Segment transfer routine vector
00AE-00B3     174-179     Monitor register save
00B4          180         Monitor stack pointer save
00B5          181         Monitor bank number save
00B6          182         [unused?  -wf]
00B7-00B8     183-184     Monitor IRQ save; pointer
00B9-00BA     185-186     Monitor memory pointer
00BB-00BC     187-188     Monitor secondary pointer
00BD          189         Monitor counter
00BE          190         Monitor miscellaneous byte
00BF          191         Monitor device number
00C0-00C1     192-193     Programmable key table address
00C2-00C3     194-195     Programmable key address
00C4-00C7     196-199     Pointers to change programmable key table

                                                                        :201:

00C8-00C9     200-201     Pointer to screen line
00CA          202         Screen line number
00CB          203         Position of cursor on line
00CC          204         0 = text mode, else graphics mode
00CD          205         Keypress variable
00CE          206         Old cursor column
00CF          207         Old cursor row
00D0          208         New character flag
00D1          209         Number of keys in keyboard buffer
00D2          210         Quotes flag
00D3          211         Insert key counter
00D4          212         Cursor type flag
00D5          213         Screen line length
00D6          214         Number of keys in "key" buffer
00D7          215         Key repeat delay
00D8          216         Key repeat speed
00D9-00DA     217-218     Temporary variables
00DB          219         Current output character
00DC          220         Top line of current screen
00DD          221         Bottom line of screen
00DE          222         Left edge of current screen
00DF          223         Right edge of screen
00E0          224         Keys:  255 = none; 127 = key; 111 = shift
00E1          225         Key pressed:  255 = no key
00E2-00E5     226-229     Line wrap bits
