# - C64 I/O Map (Mapping The Commodore 64) - $D019 (53273) VICIRQ — VIC Interrupt Flag Register: bits indicate pending VIC-II IRQ sources — bit0 raster compare, bit1 sprite-foreground collision, bit2 sprite-sprite collision, bit3 light pen trigger, bit7 overall VIC-II IRQ flag. Reading behavior: bits are latched, writing a 1 clears corresponding bit. Default write of 15 clears all interrupts. Explains how IRQ handler should read and clear bits.

$D019        VICIRQ       VIC Interrupt Flag Register

                     0    Flag:  Is the Raster Compare a possible source of an IRQ?
                            (1=yes)
                     1    Flag:  Is a collision between a sprite and the normal graphics
                            display a possible source of an IRQ?  (1=yes)
                     2    Flag:  Is a collision between two sprites a possible source of
                            an IRQ?  (1=yes)
                     3    Flag:  Is the light pen trigger a possible source of an IRQ?
                            (1=yes)
                     4-6  Not used
                     7    Flag:  Is there any VIC-II chip IRQ source which could cause
                            an IRQ?  (1=yes)

                          The VIC-II chip is capable of generating a maskable request (IRQ) when
                          certain conditions relating to the video display are fulfilled.
                          Briefly, the conditions that can cause a VIC-II chip IRQ are:

                          1.  The line number of the current screen line being scanned by the
                          raster is the same as the line number value written to the Raster
                          Register (53266, $D012).

                          2.  A sprite is positioned at the same location where normal graphics
                          data are being displayed.

                          3.  Two sprites are positioned so that they are touching.

                          4.  The light sensor on the light pen has been struck by the raster
                          beam, causing the fire button switch on joystick Control Port #1 to
                          close (pressing the joystick fire button can have the same effect).

                          When one of these conditions is met, the corresponding bit in this
                          status register is set to 1 and latched.  That means that as long as
                          the corresponding enable bit in the VIC IRQ Mask register is set to 1,
                          and IRQ requested will be generated, and any subsequent fulfillment of
                          the same condition will be ignored until the latch is cleared.

                          This allows you to preserve multiple interrupt requests if more than
                          one of the interrupt conditions is met at a time.  In order to keep an
                          IRQ source from generating another request after it has been serviced,
                          and to enable subsequent interrupt conditions to be detected, the
                          interrupt service routine must write a 1 to the corresponding bit.
                          This will clear the latch for that bit.  The default value written to
                          this register is 15, which clears all interrupts.

                          There is only 1 IRQ vector that points to the address of the routine
                          that will be executed when an IRQ interrupt occurs.  The same routine
                          will therefore be executed regardless of the source of the interrupt.
                          This status register provides a method for that routine to check what
                          the source of the IRQ was, so that the routine can take appropriate
                          action.  First, the routine can check Bit 7.  Anytime that any of the
                          other bits in the status register is set to 1, Bit 7 will also be set.
                          Therefore, if that bit holds a 1, you know that the VIC-II chip
                          requested an IRQ (the two CIA chips which are the other sources of IRQ
                          interrupts can be checked in a similar manner).  Once it has been
                          determined that the VIC chip is responsible for the IRQ, the
                          individual bits can be tested to see which of the IRQ conditions have
                          been met.

                          For more information, and a sample VIC IRQ program, see the following
                          entry.


---
Additional information can be found by searching:
- "d01a_irqmask_and_raster_interrupts" which expands on Masking and enabling VIC interrupts
- "sprite_collision_registers" which expands on Which registers to read to determine colliding sprites ($D01E-$D01F)
