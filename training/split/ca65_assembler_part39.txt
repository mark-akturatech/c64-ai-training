# CA65 Assembler - Macro Packages (.MACPACK generic, longbranch, cbm, atari)

13. Macro packages
Using the .MACPACK directive, predefined macro packages may be included with just one command. Available macro packages are:

13.1 .MACPACK generic
This macro package defines macros that are useful in almost any program. Currently defined macros are:


        .macro  add     Arg     ; add without carry
                clc
                adc     Arg
        .endmacro

        .macro  sub     Arg     ; subtract without borrow
                sec
                sbc     Arg
        .endmacro

        .macro  bge     Arg     ; branch on greater-than or equal
                bcs     Arg
        .endmacro

        .macro  blt     Arg     ; branch on less-than
                bcc     Arg
        .endmacro

        .macro  bgt     Arg     ; branch on greater-than
                .local  L
                beq     L
                bcs     Arg
        L:
        .endmacro

        .macro  ble     Arg     ; branch on less-than or equal
                beq     Arg
                bcc     Arg
        .endmacro

        .macro  bnz     Arg     ; branch on not zero
                bne     Arg
        .endmacro

        .macro  bze     Arg     ; branch on zero
                beq     Arg
        .endmacro
13.2 .MACPACK longbranch
This macro package defines long conditional jumps. They are named like the short counterpart but with the 'b' replaced by a 'j'. Here is a sample definition for the "jeq" macro, the other macros are built using the same scheme:


        .macro  jeq     Target
                .if     .def(Target) .and ((*+2)-(Target) <= 127)
                beq     Target
                .else
                bne     *+5
                jmp     Target
                .endif
        .endmacro
All macros expand to a short branch, if the label is already defined (back jump) and is reachable with a short jump. Otherwise the macro expands to a conditional branch with the branch condition inverted, followed by an absolute jump to the actual branch target.

The package defines the following macros:


        jeq, jne, jmi, jpl, jcs, jcc, jvs, jvc
13.3 .MACPACK apple2
This macro package defines a macro named scrcode. It takes a string as argument and places this string into memory translated into screen codes.

13.4 .MACPACK atari
This macro package defines a macro named scrcode. It takes a string as argument and places this string into memory translated into screen codes.

13.5 .MACPACK cbm
This macro package defines a macro named scrcode. It takes a string as argument and places this string into memory translated into screen codes.

13.6 .MACPACK module
This macro package defines a macro named module_header. It takes an identifier as argument and is used to define the header of a module both in the dynamic and static variant.

