# CA65 Assembler - Pseudo Functions (.REF .RIGHT .SIZEOF)

10.23 .SIZEOF
.SIZEOF() is a pseudo function that returns the size of its argument. The argument can be a struct/union, a struct member, a scope/procedure, or a label. In the case of a procedure or label, its size is defined by the amount of data placed in the segment where the label is relative to. If a line of code switches segments (for example, in a macro), data placed in other segments does not count for the size.

Please note that a symbol or scope must exist before it can be used together with .SIZEOF() (that may get relaxed later, but always will be true for scopes). A scope has preference over a symbol with the same name; so, if the last part of a name represents both a scope and a symbol, then the scope is chosen over the symbol.

After the following code:


        .struct Point                   ; Struct size = 4
                xcoord  .word
                ycoord  .word
        .endstruct

        P:      .tag    Point           ; Declare a point
        @P:     .tag    Point           ; Declare another point

        .code
        .proc   Code
                nop
                .proc   Inner
                        nop
                .endproc
                nop
        .endproc

        .proc   Data
        .data                           ; Segment switch!!!
                .res    4
        .endproc
  

.sizeof(Point)
will have the value 4, because this is the size of struct Point.

.sizeof(Point::xcoord)
will have the value 2, because this is the size of the member xcoord in struct Point.

.sizeof(P)
will have the value 4, this is the size of the data declared on the same source line as the label P, which is in the same segment that P is relative to.

.sizeof(@P)
will have the value 4, see above. The example demonstrates that .SIZEOF does also work for cheap local symbols.

.sizeof(Code)
will have the value 3, since this is amount of data emitted into the code segment, the segment that was active when Code was entered. Note that this value includes the amount of data emitted in child scopes (in this case Code::Inner).

.sizeof(Code::Inner)
will have the value 1 as expected.

.sizeof(Data)
will have the value 0. Data is emitted within the scope Data, but since the segment is switched after entry, this data is emitted into another segment.

10.24 .SPRINTF
