# - C64 I/O Map (Mapping The Commodore 64) - $D018 (53272) VMCSB â€” VIC-II Memory Control Register: lower nybble (bits1-3) control character dot-data base address (even 1K offsets 0..14) and significance in bitmap mode (bit3 chooses 0 or 8K). Upper nybble (bits4-7) control Video Matrix base address in 1K increments (0..15). Includes default values and notes on updating BASIC pointer (location 648) when moving screen memory.

$D018        VMCSB        VIC-II Chip Memory Control Register

                     0    Unused
                     1-3  Text character dot-data base address within VIC-II address
                            space
                     4-7  Video matrix base address within VIC-II address space

                          This register affects virtually all graphics operations.  It
                          determines the vase address of two very important data areas, the
                          Video Matrix, and the Character Dot-Data area.

                          Bits 1-3.  These bits are used to set the location of the Character
                          Dot-Data area.  This area is where the data is stored (for more
                          information on character shape data, see the alternate entry for
                          location 53248 ($D000), the Character Generator ROM).

                          Bits 1-3 can represent any even number from 0 to 14.  That number
                          stands for the even 1K offset of the character data area from the
                          beginning of VIC-II memory.  For example, if these bits are all set to
                          0, it means that the character memory occupies the first 2K of VIC-II
                          memory.  If they equal 2, the data area starts 2*1K (2*1024) or 2048
                          bytes from the beginning of VIC memory.

                          The default value of this nybble is 4.  This sets the address of the
                          Character Dot-Data area to 4096 ($1000), which is the starting address
                          of where the VIC-II chip addresses the Character ROM.  The normal
                          character set which contains uppercase and graphics occupies the first
                          2K of that ROM.  The alternate character set which contains both
                          upper- and lowercase letters use the second 2K.  Therefore, to shift
                          to the alternate character set, you must change the value of this
                          nybble to 6, with a POKE 53272,PEEK(53272)OR2.  To change it back,
                          POKE 53272,PEEK(53272)AND253.

                          In bitmap mode, the lower nybble controls the location of the bitmap
                          screen data.  Since this data area can start only at an offset of 0 or
                          8K from the beginning of VIC-II memory, only Bit 3 of the Memory
                          Control Register is significant in bitmap mode.  If Bit 3 holds a 0,
                          the offset is 0, and if it holds a 1, the offset is 8192 (8K).

                          Bits 4-7.  This nybble determines the starting address of the Video
                          Matrix area.  This is the 1024-byte area of memory which contains the
                          screen codes for the text characters that are displayed on the screen.
                          In addition, the last eight bytes of this area are used as pointers
                          which designate which 64- byte block of VIC-II memory will be used as
                          shape data for each sprite.

                          These four bits can represent numbers from 0 to 15.  These numbers
                          stand for the offset (in 1K increments) from the beginning of VIC-II
                          memory to the Video Matrix.

                          For example, the default bit pattern is 0001.  This indicates that the
                          Video Matrix is offset by 1K from the beginning of VIC-II memory, the
                          normal starting place for screen memory.  Remember, though, the bit
                          value of this number will be 16 times what the bit pattern indicates,
                          because we are dealing with Bits 4-7.  Therefore, the 0001 in the
                          upper nybble has a value of 16.

                          Using this register, we can move the start of screen memory to any 1K
                          boundary within the 16K VIC-II memory area.  Just changing this
                          register, however, is not enough if you want to use the BASIC line
                          editor.  The editor looks to location 648 ($288) to determine where to
                          print screen characters.

                          If you just change the location of the Video Matrix without changing
                          the value in 648, BASIC will continue to print characters in the
                          memory area starting at 1024, even though that area is no longer being
                          displayed.  The result is that you will not be able to see anything
                          that you type in on the keyboard.  To fix this, you must POKE 648 with
                          the page number of the starting address of screen memory (page
                          number=location/256).  Remember, the actual starting address of screen
                          memory depends not only on the offset from the beginning of VIC-II
                          memory in the register, but also on which bank of 16K is used for
                          VIC-II memory.

                          For example, if the screen area starts 1024 bytes from the beginning
                          of VIC- II memory, and the video chip is using Bank 2 (32768-49151),
                          the actual starting address of screen memory is 32768+1024=33792
                          ($8400).  For examples of how to change the video memory area, and of
                          how to relocate the screen, see the entry for 56576 ($DD00).


---
Additional information can be found by searching:
- "video_matrix_and_character_dot_data" which expands on Effect on displayed text & character shapes
- "bitmap_addressing_and_plotting" which expands on Choosing BASE for bitmap and color memory mapping
