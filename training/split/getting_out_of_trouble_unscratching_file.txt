# byRiclianll - Beginning of Chapter 8 'GETTING OUT OF TROUBLE'. Introduction stressing backups and recovery, followed by section 8.1 'Unscratching a File'. Explains what happens when a file is scratched (directory file-type byte set to $00 and sectors freed in the BAM) and the high-level steps to recover: restore file-type byte and VALIDATE the disk to reallocate sectors. Describes using the VIRTUAL DIRECTORY and EDIT TRACK & SECTOR utilities and details STEP 1: running VIRTUAL DIRECTORY to identify which group (sector) the scratched entry is in, how groups map to sectors, and the table mapping directory groups to track 18 sector numbers (partial table as present in this excerpt).

172 


CHAPTER  8 


GETTING  OUT  OF  TROUBLE 


The  best  way  to  get  out  of  trouble  is  to  stay  out  of  trouble  in  the  first  place!  It  is  much 
easier  to  recover  a  lost  file  by  digging  out  an  archival  copy  than  trying  to  recover  it 
from  a  blown  diskette.  Need  we  remind  you?  BACKUP!  BACKUP!  BACKUP! 

However,  since  we  feel  that  Murphy  was  a  rash  optimist,  the  likelihood  of  you  always 
finding  that  backup  copy  is  minimal,  unless  of  course,  you  manage  to  recover  that  file 
on  the  diskette.  Then,  and  only  then,  will  the  archival  copy  magically  appear  right  where 
you  thought  you  left  it. 

Since  you  are  reading  this  chapter,  you  probably  have  a  problem  and  are  in  desperate 
need  of  help.  Please  read  on. 

8.1  Unscratching  a  File 

Inadvertently  scratching  a  file  is  by  far  the  most  common  problem.  As  long  as  you  have 
not  written  any  new  information  to  the  diskette  since  you  scratched  that  file,  it  can  be 
recovered.  Recall  that  when  a  file  is  scratched,  it  is  not  erased  from  the  diskette.  Only 
two  things  have  happened: 

1.  The  file-type  byte  in  the  directory  entry  is  set  to  $00. 

2.  The  sectors  associated  with  that  file  are  freed  in  the  BAM. 

To  unscratch  a  file,  all  you  have  to  do  is  change  the  file-type  byte  back  to  its  original 
value  and  VALIDATE  the  diskette  to  re-allocate  the  sectors. 

The  programs  VIRTUAL  DIRECTORY  and  EDIT  TRACK  &  SECTOR,  which  are 
listed  in  Appendix  C,  help  you  to  do  this.  Here's  how  you  should  use  these  programs 
to  recover  a  scratched  file. 

STEP  1.  Load  and  run  the  VIRTUAL  DIRECTORY  program  on  the  diskette.  The  direc- 
tory will  be  displayed  in  groups  of  eight  entries.  Scratched  files  are  highlighted 
in  reverse  video.  Each  group  constitutes  a  different  sector  on  track  18.  Count 
the  groups  to  determine  which  group  the  scratched  entry  is  in.  Note  not  only 
which  group  the  scratched  entry  is  in,  but  also  whether  it  is  in  the  first  half 
or  the  last  half  of  the  group.  (One  of  the  first  four  file  entries  or  one  of  the 
last  four.) 

Consult  the  table  below  to  determine  the  number  of  the  sector  containing  the  entry. 


173 


Group  -  Sector 


Group  -  Sector 


Group  -  Sector 


1 
2 
3 
4 
5 
6 


18,1 

18,4 

18,7 

18,10 

18,13 

18,16 


7 
8 
9 
10 
11 
12 


18,2 

18,5 

18,8 

18,11 

18,14 


---
Additional information can be found by searching:
- "copy_file_machine_code_listing" which expands on previous chapter's machine-code examples referenced earlier in the manual
- "copy_file_source_annotation_and_conclusion" which expands on the concluding remarks that directly precede this chapter
