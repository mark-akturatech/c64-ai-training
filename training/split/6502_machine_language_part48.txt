# ML for C64 - Appendix I: CIA Chip Reference

RING MOD (Bit 2):  The RING MOD bit, when set to a one, replaces the Triangle
waveform output of Oscillator 1 with a "Ring Modulated" combination of
Oscillators 1 and 3.  Varying the frequency of Oscillator 1 with respect to
Oscillator 3 produces a wide range of non-harmonic overtone structures for
creating bell or gong sounds and for special effects.  In order for ring
modulation to be audible, the Triangle waveform of Oscillator 1 must be
selected and Oscillator 3 must be set to some frequency other than zero.  No
other parameters of Voice 3 have any effect on ring modulation.

TEST (Bit 3):  The TEST bit, when set to a one, resets and locks Oscillator 1
at zero until the TEST bit is cleared.  The Noise waveform output of
Oscillator 1 is also reset and the Pulse waveform output is held at a DC
level.  Normally this bit is used for testing purposes, however, it can be
used to synchronize Oscillator 1 to external events, allowing the generation
of highly complex waveforms under real-time software control.

                                                                        :298:

(Bit 4):  When set to a one, the Triangle Waveform output of Oscillator 1 is
selected.  The Triangle waveform is low in harmonics and has a mellow,
flute-like quality.

(Bit 5):  When set to a one, the Sawtooth waveform output of Oscillator 1 is
selected.  The Sawtooth waveform is rich in even and odd harmonics and has a
bright, brassy quality.

(Bit 6):  When set to a one, the Pulse waveform of Oscillator 1 is selected.
The harmonic content of this waveform can be adjusted by the Pulse Width
registers, producing tone qualities ranging from a bright, hollow square wave
to a nasal, reedy pulse.  Sweeping the pulse width in real-time produces a
dynamic "phasing" effect which adds a sense of motion to the sound.  Rapidly
jumping between different pulse widths can produce interesting harmonic
sequences.

NOISE (Bit 7):  When set to a one, the Noise output waveform of Oscillator 1
is selected.  This output is a random signal which changes at the frequency
of Oscillator 1.  The sound quality can be varied from a low rumbling to
hissing white noise via the Oscillator 1 Frequency registers.  Noise is
useful in creating explosions, gunshots, jet engines, wind, surf and other
unpitched sounds, as well as snare drums and cymbals.  Sweeping the
oscillator frequency with Noise selected produces a dramatic rushing effect.

One of the output waveforms must be selected for Oscillator 1 to be audible,
however, it is NOT necessary to de-select waveforms to silence the output of
Voice 1.  The amplitude of Voice 1 at the final output is a function of the
Envelope Generator only.

  *------------------------------------------------------------------------*
  | NOTE:  The oscillator output waveforms are NOT additive.  If more than |
  | one output waveform is selected simultaneously, the result will be a   |
  | logical ANDing of the waveforms.  Although this technique can be used  |
  | to generate additional waveforms beyond the four listed above, it must |
  | be used with care.  If any other waveform is selected while Noise is   |
  | on, the Noise output can "lock up."  If this occurs, the Noise output  |
  | will remain silent until reset by the TEST bit or by bringing RES (pin |
  | 5) low.                                                                |
  *------------------------------------------------------------------------*


ATTACK/DECAY (Register 05)

Bits 4-7 of this register (ATK0-ATK3) select 1 of 16 ATTACK rates for the
Voice 1 Envelope Generator.  The ATTACK rate determines how rapidly the
output of Voice 1 rises from zero to peak amplitude when the Envelope
Generator is Gated.  The 16 ATTACK rates are listed in Table 1.

                                                                        :299:

Bits 0-3 (DCY0-DCY3) select 1 of 16 DECAY rates for the Envelope Generator.
The DECAY cycle follows the ATTACK cycle and the DECAY rate determines how
rapidly the output falls from the peak amplitude to the selected SUSTAIN
level.  The 16 DECAY rates are listed in Table 1.


SUSTAIN/RELEASE (Register 06)

Bits 4-7 of this register (STN0-STN3) select 1 of 16 SUSTAIN levels for the
Envelope Generator.  The SUSTAIN cycle follows the DECAY cycle and the output
of Voice 1 will remain at the selected SUSTAIN amplitude as long as the Gate
bit remains set.  The SUSTAIN levels range from zero to peak amplitude in 16
linear steps, with a SUSTAIN value of 0 selecting zero amplitude and a
SUSTAIN value of 15 ($F) selecting the peak amplitude on-half the peak
amplitude reached by the ATTACK cycle.

Bits 0-3 (RLS0-RLS3) select 1 of 16 RELEASE rates for the Envelope Generator.
The RELEASE cycle follows the SUSTAIN cycle when the Gate bit is set to zero.
At this time, the output of Voice 1 will fall from the SUSTAIN amplitude to
zero amplitude at the selected RELEASE rate.  The 16 RELEASE rates are
identical to the DECAY rates.

  *------------------------------------------------------------------------*
  | NOTE:  The cycling of the Envelope Generator can be altered at any     |
  | point via the Gate bit.  The Envelope Generator can be Gated and       |
  | Released without restriction.  For example, if the Gate bit is reset   |
  | before the envelope has finished the ATTACK cycle, the RELASE cycle    |
  | will immediately begin, starting from whatever amplitude had been      |
  | reached.  If the envelope is then gated again (before the RELEASE      |
  | cycle has reached zero amplitude), another ATTACK cycle will begin,    |
  | starting from whatever amplitude had been reached.  This technique can |
  | be used to generate complex amplitude envelopes via real-time software |
  | control.                                                               |
  *------------------------------------------------------------------------*

                                                                        :300:

                           Table 1.  Envelope Rates

                 +-----------+--------------+---------------+
                 |   VALUE   | ATTACK RATE  | DECAY/RELEASE |
                 |           |              |     RATE      |
                 +-----------+--------------+---------------+
                 | DEC (HEX) | (Time/Cycle) | (Time/Cycle)  |
                 +-----------+--------------+---------------+
                 |   0 (0)   |      2 ms    |      6 ms     |
                 |   1 (1)   |      8 ms    |     24 ms     |
                 |   2 (2)   |     16 ms    |     48 ms     |
                 |   3 (3)   |     24 ms    |     72 ms     |
                 |   4 (4)   |     38 ms    |    114 ms     |
                 |   5 (5)   |     56 ms    |    168 ms     |
                 |   6 (6)   |     68 ms    |    204 ms     |
                 |   7 (7)   |     80 ms    |    240 ms     |
                 |   8 (8)   |    100 ms    |    300 ms     |
                 |   9 (9)   |    250 ms    |    750 ms     |
                 |  10 (A)   |    500 ms    |    1.5 s      |
                 |  11 (B)   |    800 ms    |    2.4 s      |
                 |  12 (C)   |      1 s     |      3 s      |
                 |  13 (D)   |      3 s     |      9 s      |
                 |  14 (E)   |      5 s     |     15 s      |
                 |  15 (F)   |      8 s     |     24 s      |
                 +-----------+--------------+---------------+

                 NOTE:  Envelope rates are based on a 1.0-MHz
                 phi2 clock.  For other phi2 frequencies,
                 multiply the given rate by 1MHz/phi2.  The
                 rates refer to the amount of time per cycle.
                 For example, given an ATTACK value of 2, the
                 ATTACK cycle would take 16ms to rise from
                 zero to peak amplitude.  The DECAY/RELEASE
                 rates refer to the amount of time these
                 cycles would take to fall from peak
                 amplitude to zero.



Voice 2
-------

Registers 07-$0D control Voice 2 and are functionally identical to registers
00-06 with these exceptions:

  1)  When selected, SYNC synchronizes Oscillator 2 with Oscillator 1.

  2)  When selected, RING MOD replaces the Triangle output of Oscillator 2
      with the ring modulated combination of Oscillators 2 and 1.


Voice 3
-------

Registers $0E-$14 control Voice 3 and are functionally identical to register
00-06 with these exceptions:

  1)  When selected, SYNC synchronizes Oscillator 3 with Oscillator 2.

  2)  When selected, RING MOD replaces the Triangle output of Oscillator 3
      with the ring modulated combination of Oscillators 3 and 2.

Typical operation of a voice consists of selecting the desired parameters:
frequency, waveform, effects (SYNC, RING MOD) and envelope rates, then gating
the voice whenever the sound is desired.  The sound can be sustained for any
length of time and terminated by clearing the Gate bit.

                                                                        :301:

Each voice can be used separately, with independent parameters and gating, or
in unison to create a single, powerful voice.  When used in unison, a slight
detuning of each oscillator or tuning to musical intervals creates a rich,
animated sound.


Filter
------

FC LOW/FC HIGH (Registers $15, $16)

Together these registers form an 11-bit number (bits 3-7 of FC LOW are not
used) which linearly controls the Cutoff (or Center) Frequency of the
programmable Filter.  The approximate Cutoff Frequency ranges from 30 Hz to
12 KHz.


RES/FLT (Register $17)

Bits 4-7 of this register (RES0-RES3) control the resonance of the filter.
Resonance is a peaking effect which emphasizes frequency components at the
Cutoff Frequency, causing a sharper sound.  There are 16 resonance settings
ranging linearly from no resonance (0) to maximum resonance (15 or $F).  Bits
0-3 determine which signals will be routed through the filter.

FLT1 (Bit 0):  When set to a zero, Voice 1 appears directly at the audio
output and the Filter has no effect on it.  When set to a one, Voice 1 will
be processed through the Filter and the harmonic content of Voice 1 will be
altered according to the selected Filter parameters.

FLT2 (Bit 1):  Same as bit 0 for Voice 2.

FLT3 (Bit 2):  Same as bit 0 for Voice 3.

FLTEX (Bit 3):  Same as bit 0 for External audio input (pin 26).


MODE/VOL (Register $18)

Bits 4-7 of this register select various Filter mode and output options:

LP (Bit 4):  When set to a one, the Low-Pass output of the Filter is selected
and sent to the audio output.  For a given Filter input signal, all frequency
components below the Cutoff Frequency are passed unaltered, while all
frequency components above the Cutoff are attenuated at a rate of 12
dB/Octave.  The Low-Pass mode produces full-bodied sounds.

BP (Bit 5):  Same as bit 4 for the Bandpass output.  All frequency components
above and below the Cutoff are attenuated at a rate of 6 dB/Octave.  The
Bandpass mode produces thin, open sounds.

                                                                        :302:

HP (Bit 6):  Same as bit 4 for the High-Pass output.  All frequency
components above the Cutoff are passed unaltered, while all frequency
components below the Cutoff are attenuated at a rate of 12 dB/Octave.  The
High-Pass mode produces tinny, buzzy sounds.

3OFF (Bit 7):  When set to a one, the output of Voice 3 is disconnected from
the direct audio path.  Setting Voice 3 to bypass the Filter (FLT3 = 0) and
setting 3OFF to a one prevents Voice 3 from reaching the audio output.  This
allows Voice 3 to be used for modulation purposes without any undesirable
output.

  *------------------------------------------------------------------------*
  | NOTE:  The Filter output modes ARE additive and multiple Filter modes  |
  | may be selected simultaneously.  For example, both LP and HP modes can |
  | be selected to produce a Notch (or Band Reject) Filter response.  In   |
  | order for the Filter to have any audible effect, at least one Filter   |
  | output must be selected and at least one Voice must be routed through  |
  | the Filter.  The Filter is, perhaps, the most important element in SID |
  | as it allows the generation of complex tone colors via subtractive     |
  | synthesis (the Filter is used to eliminate specific frequency          |
  | components from a harmonically rich input signal).  The best results   |
  | are achieved by varying the Cutoff Frequency in real-time.             |
  *------------------------------------------------------------------------*

VOL0-VOL3 (Bits 0-3) select 1 of 16 overall Volume levels for the final
composite audio output.  The output volume levels range from no output (0) to
maximum volume (15 or $F) in 16 linear steps.  This control can be used as a
static volume control for balancing levels in multi-chip systems or for
creating dynamic volume effects, such as Tremolo.  Some Volume level other
than zero must be selected in order for SID to produce any sound.


Miscellaneous
-------------

POTX (Register $19)

This register allows the microprocessor to read the position of the
potentiometer tied to POTX (pin 24), with values ranging from 0 at minimum
resistance, to 255 ($FF) at maximum resistance.  The value is always valid
and is updated every 512 phi2 clock cycles.  See the Pin Description section
for information on pot and capacitor values.


POTY (Register $1A)

Same as POTX for the pot tied to POTY (pin 23).

                                                                        :303:

OSC3/RANDOM (Register $1B)

This register allows the microprocessor to read the upper 8 output bits of
Oscillator 3.  The character of the numbers generated is directly related to
the waveform selected.  If the Sawtooth waveform of Oscillator 3 is selected,
this register will present a series of numbers incrementing from 0 to 255
($FF) at a rate determined by the frequency of Oscillator 3.  If the Triangle
waveform is selected, the output will increment from 0 up to 255, then
decrement down to 0.  If the Pulse waveform is selected, the output will jump
between 0 and 255.  Selecting the Noise waveform will produce a series of
random numbers, therefore, this register can be used as a random number
generator for games.  There are numerous timing and sequencing applications
for the OSC3 register, however, the chief function is probably that of a
modulation generator.  The numbers generated by this register can be added,
via software, to the Oscillator or Filter Frequency register or the Pulse
Width registers in real-time.  Many dynamic effects can be generated in this
manner.  Siren-like sounds can be created by adding the OSC3 Sawtooth output
to the frequency control of another oscillator.  Synthesizer "Sample and
Hold" effects can be produced by adding the OSC3 Noise output to the Filter
Frequency control registers.  Vibrato can be produced by setting Oscillator 3
to a frequency around 7 Hz and adding the OSC3 Triangle output (with proper
scaling) to the Frequency control of another oscillator.  An unlimited range
of effects are available by altering the frequency of Oscillator 3 and
scaling the OSC3 output.  Normally, when Oscillator 3 is used for modulation,
the audio output of Voice 3 should be eliminated (3OFF = 1).


ENV3 (Register $1C)

Same as OSC3, but this register allows the microprocessor to read the output
of the Voice 3 Envelope Generator.  This output can be added to the Filter
Frequency to produce harmonic envelopes, Wah-Wah, and similar effects.
"Phaser" sounds can be created by adding this output to the frequency control
registers of an oscillator.  The Voice 3 Envelope Generator must be Gated in
order to produce any output from this register.  The OSC3 register, however,
always reflects the changing output of the oscillator and is not affected in
any way by the Envelope Generator.

                                                                        :304:

6525 Tri-Port Interface
