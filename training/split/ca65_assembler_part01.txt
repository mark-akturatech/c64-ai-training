ca65 Users Guide
Ullrich von Bassewitz,
Greg King
ca65 is a powerful macro assembler for the 6502, 65C02, and 65816 CPUs. It is used as a companion assembler for the cc65 crosscompiler, but it may also be used as a standalone product.

1. Overview
ca65 is a replacement for the ra65 assembler that was part of the cc65 C compiler, originally developed by John R. Dunning. I had some problems with ra65 and the copyright does not permit some things which I wanted to be possible, so I decided to write a completely new assembler/linker/archiver suite for the cc65 compiler. ca65 is part of this suite.

Some parts of the assembler (code generation and some routines for symbol table handling) are taken from an older crossassembler named a816 written by me a long time ago.

1.1 Design criteria
Here's a list of the design criteria, that I considered important for the development:


The assembler must support macros. Macros are not essential, but they make some things easier, especially when you use the assembler in the backend of a compiler.
The assembler must support the newer 65C02 and 65816 CPUs. I have been thinking about a 65816 backend for the C compiler, and even my old a816 assembler had support for these CPUs, so this wasn't really a problem.
The assembler must produce relocatable code. This is necessary for the compiler support, and it is more convenient.
Conditional assembly must be supported. This is a must for bigger projects written in assembler (like Elite128).
The assembler must support segments, and it must support more than three segments (this is the count, most other assemblers support). Having more than one code segments helps developing code for systems with a divided ROM area (like the C64).
The linker must be able to resolve arbitrary expressions. It should be able to get things like
        .import S1, S2
        .export Special
        Special = 2*S1 + S2/7
right.
True lexical nesting for symbols. This is very convenient for larger assembly projects.
"Cheap" local symbols without lexical nesting for those quick, late night hacks.
I liked the idea of "options" as Anre Fachats .o65 format has it, so I introduced the concept into the object file format use by the new cc65 binutils.
The assembler will be a one pass assembler. There was no real need for this decision, but I've written several multipass assemblers, and it started to get boring. A one pass assembler needs much more elaborated data structures, and because of that it's much more fun:-)
Non-GPLed code that may be used in any project without restrictions or fear of "GPL infecting" other code.
2. Usage
2.1 Command line option overview
The assembler accepts the following options:


---------------------------------------------------------------------------
Usage: ca65 [options] file
Short options:
  -D name[=value]               Define a symbol
  -I dir                        Set an include directory search path
  -U                            Mark unresolved symbols as import
  -V                            Print the assembler version
  -W n                          Set warning level n
  -d                            Debug mode
  -g                            Add debug info to object file
  -x                            Expand macros in the listing
                                repeat -x for full expansion
  -h                            Help (this text)
  -i                            Ignore case of symbols
  -l name                       Create a listing file if assembly was ok
  -mm model                     Set the memory model
  -o name                       Name the output file
  -s                            Enable smart mode
  -S                            Generate segment offsets in listing
  -t sys                        Set the target system
  -v                            Increase verbosity

Long options:
  --auto-import                 Mark unresolved symbols as import
  --bin-include-dir dir         Set a search path for binary includes
  --color [on|auto|off]         Color diagnostics (default: auto)
  --cpu type                    Set cpu type
  --create-dep name             Create a make dependency file
  --create-full-dep name        Create a full make dependency file
  --debug                       Debug mode
  --debug-info                  Add debug info to object file
  --expand-macros               Expand macros in listing
                                Repeat to get full expansion
  --feature name                Set an emulation feature
  --help                        Help (this text)
  --ignore-case                 Ignore case of symbols
  --include-dir dir             Set an include directory search path
  --large-alignment             Don't warn about large alignments
  --listing name                Create a listing file if assembly was ok
  --list-bytes n                Maximum number of bytes per listing line
  --memory-model model          Set the memory model
  --no-utf8                     Disable use of UTF-8 in diagnostics
  --pagelength n                Set the page length for the listing
  --relax-checks                Relax some checks (see docs)
  --segment-list                Generate segment offsets in listing
  --smart                       Enable smart mode
  --target sys                  Set the target system
  --verbose                     Increase verbosity
  --version                     Print the assembler version
  --warn-align-waste            Print bytes "wasted" for alignment
  --warnings-as-errors          Treat warnings as errors
---------------------------------------------------------------------------
2.2 Command line options in detail
