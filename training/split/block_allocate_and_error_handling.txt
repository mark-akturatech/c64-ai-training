# ********* - Section 6.5: BLOCK-ALLOCATE command (PRINT#file#,"B-A:" drive; track; block) to mark a block in the BAM as used; explains how to detect 'NO BLOCK' error (error 65) and procedure to handle allocation failures by reading suggested next available block from the error channel. Includes a sample allocation loop.



6.5 BLOCK-ALLOCATE

In order to safely use random files along with regular files, your
programs must check the BAM to find available blocks, and change the
BAM to reflect that you've used them.  Once you update the BAM, your
random files will be safe -- at least unless you perform the VALIDATE
command (see chapter 3).

FORMAT FOR THE BLOCK-ALLOCATE COMMAND:

   PRINT#file#, "BLOCK-ALLOCATE:" drive; track; block

How do you know which blocks are available to use?  If you try a block
that isn't available the DOS will set the error message to number 65,
NO BLOCK, and set the track and block numbers to the next available
track and block number.  Therefore, any time you attempt to write a
block to the disk, you must first try to allocate that block. If that
block isn't available, read the next block available from the error
channel and then allocate that block.

EXAMPLE OF PROCEDURE TO ALLOCATE BLOCK:

			    +-------+
			    | DRIVE |
 10 OPEN 15,8,15   +--------+-------+
 20 OPEN 5,8,5,"#" |        | TRACK |
 30 PRINT#5,"DATA" | +------+-------+
 40 T=1:B=1        | |      | BLOCK |
 50 PRINT#15,"B-A:"0;T;B <--+-------+
 60 INPUT#15,A,B$,C,D
 70 IF A=65 THEN T=C:B=D:GOTO 50
 80 PRINT#15,"B-W:"5;0;1;1
 90 CLOSE 5:CLOSE 15


---
Additional information can be found by searching:
- "block_free_command" which expands on counterpart operation to free blocks no longer needed
- "using_random_files_with_sequential_indexing_examples" which expands on example programs showing allocation and use of sequential index files
