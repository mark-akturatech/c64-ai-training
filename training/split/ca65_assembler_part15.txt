# CA65 Assembler - Pseudo Functions (.ADDRSIZE .BANK .BANKBYTE .BLANK .CAP)

10. Pseudo functions
Pseudo functions expect their arguments in parentheses, and they have a result, either a string or an expression value.

10.1 .ADDRSIZE
The .ADDRSIZE function is used to return the internal address size associated with a symbol. This can be helpful in macros when knowing the address size of a symbol can help with custom instructions.

Example:


        .macro myLDA foo
                .if .ADDRSIZE(foo) = 1
                        ;do custom command based on zeropage addressing:
                        .byte 0A5h, foo
                .elseif .ADDRSIZE(foo) = 2
                        ;do custom command based on absolute addressing:
                        .byte 0ADh
                        .word foo
                .elseif .ADDRSIZE(foo) = 0
                        ; no address size defined for this symbol:
                        .out .sprintf("Error, address size unknown for symbol %s", .string(foo))
                .endif
        .endmacro
  
10.2 .BANK
The .BANK function is used to support systems with banked memory. The argument is an expression with exactly one segment reference -- usually a label. The function result is the value of the bank attribute assigned to the run memory area of the segment. Please see the linker documentation for more information about memory areas and their attributes.

The value of .BANK can be used to switch memory so that a memory bank containing specific data is available.

The bank attribute is a 32-bit integer, and so is the result of the .BANK function. You will have to use .LOBYTE or similar functions to address just part of it.

Please note that .BANK always will get evaluated in the link stage, so an expression containing .BANK never can be used where a constant, known result is expected (for example, with .RES).

Example:


        .segment "BANK1"
        .proc   banked_func_1
                ...
        .endproc

        .segment "BANK2"
        .proc   banked_func_2
                ...
        .endproc

        .proc   bank_table
                .addr   banked_func_1
                .byte   <.BANK (banked_func_1)

                .addr   banked_func_2
                .byte   <.BANK (banked_func_2)
        .endproc
  
10.3 .BANKBYTE
The function returns the bank byte (that is, bits 16-23) of its argument. It works identical to the '^' operator.

See: .HIBYTE, .LOBYTE

10.4 .BLANK
Builtin function. The function evaluates its argument in parentheses and yields "false" if the argument is non blank (there is an argument), and "true" if there is no argument. The token list that makes up the function argument may optionally be enclosed in curly braces. This allows the inclusion of tokens that would otherwise terminate the list (the closing right parenthesis). The curly braces are not considered part of the list, a list just consisting of curly braces is considered to be empty.

As an example, the .IFBLANK statement may be replaced by


        .if     .blank({arg})
  
10.5 .CAP, .CAPABILITY
Builtin function. The function allows to check for capabilities of the currently selected CPU or target system. It must be called with a comma separated list of identifiers and returns non zero if all of the given capabilities are available. Otherwise it returns zero.

Existing capabilities are:


CPU_HAS_BITIMM
Checks for the availability of the "bit #imm" instruction.

CPU_HAS_BRA8
Checks for the availability of a short (8 bit) branch.

CPU_HAS_INA
Checks for the availability of accu inc/dec instructions.

CPU_HAS_PUSHXY
Checks for the capability to push and pop the X and Y registers.

CPU_HAS_ZPIND
Checks for the availability of the "zeropage indirect" addressing mode as it is implemented in the 65SC02 CPU.

CPU_HAS_STZ
Checks for the availability of the "store zero" instruction as it is implemented in the 65SC02 CPU.

Case is ignored when checking the identifiers. The .cap function is easier to use than checking .cpu and requires no intimate knowledge of all instruction sets. For more detailed checking .cpu is still available.

Example:


        .if     .cap(CPU_HAS_BRA, CPU_HAS_PUSHXY)
                phx
                bra     L1
        .else
                txa
                pha
                jmp     L1
        .endif
  
See also: .CPU

10.6 .CONCAT
Builtin string function. The function allows to concatenate a list of string constants separated by commas. The result is a string constant that is the concatenation of all arguments. This function is most useful in macros and when used together with the .STRING builtin function. The function may be used in any case where a string constant is expected.

Example:
