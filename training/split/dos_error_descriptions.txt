# byRiclianll - Detailed descriptions of DOS error conditions and causes: read-timeout/no sync ($03), header block not found ($02 after 90 attempts), checksum error in header ($09 returned by FDC when independent checksum doesn't match), disk ID mismatch (header IDs vs. master IDs at $0012/$0013), data block not present (first decoded byte mismatch with preset data block identifier at $0047), checksum error in data block (independent checksum mismatch). Also includes write-side errors: DOS mismatch (writing to incompatible format; DOS version at $0101 check), disk ID mismatch during write, write-protect on, write-verify error (data written did not match RAM on readback), and OK return values.

Each  error  is  described  in  greater  detail  below. 

21  READ  ERROR  (NO  SYNC  CHARACTER) 

The  FDC  could  not  find  a  sync  mark  (10  or  more  consecutive  on  bits)  on  a  given  track 
within  a  prescribed  20  millisecond  time  limit.  A  time  out  has  occurred. 


20  READ  ERROR  (HEADER  BLOCK  NOT  FOUND) 

The  FDC  could  not  find  a  OCR  header  block  identifier  ($52)  after  90  attempts.  The  FDC 
did  a  seek  to  a  track  and  found  a  sync  character.  The  FDC  then  read  the  first  GCR 
byte  immediately  following  it.  This  GCR  byte  was  compared  against  a  GCR  $52  ($08). 
The  comparison  failed  and  the  try  counter  was  decremented.  The  FDC  waited  for  another 
sync  character  and  tried  again.  Ninety  attempts  were  made. 

27  READ  ERROR  (CHECKSUM  ERROR  IN  HEADER  BLOCK) 

The  FDC  found  a  header  block  on  that  track.  This  header  block  was  read  into  RAM 
and  the  GCR  bytes  were  converted  back  to  their  original  binary  form.  The  FDC  then 
EORed  the  sector  number,  the  track  number,  the  ID  LO,  and  the  ID  HI  together.  This 
independent  checksum  was  EORed  against  the  actual  checksum  found  in  the  header 
block  itself.  If  the  result  of  the  EOR  was  not  equal  zero,  the  checksums  were  not  equal. 
The  comparison  failed  and  the  FDC  returned  a  $09  to  the  error  handler. 


29  READ  ERROR  (DISK  ID  MISMATCH) 

The  IDs  recorded  in  the  header  block  found  above  did  not  match  the  master  copy  of 
the  disk  id's  stored  in  $0012  and  $0013.  These  zero  page  memory  addresses  are  normal- 
ly updated  from  track  18  during  initialization  of  a  diskette.  Note  that  they  also  can  be 
updated  by  a  seek  to  a  track  from  the  job  queue. 


20  READ  ERROR  (HEADER  BLOCK  NOT  FOUND) 

A  GCR  image  of  the  header  was  created  using  the  sector  number,  the  track  number, 
and  the  master  disk  IDs.  The  FDC  attempted  to  find  a  header  on  this  track  that  match- 
ed the  GCR  image  in  RAM  for  that  sector.  Ninety  attempts  were  made  before  this  er- 
ror was  reported. 


120 


22  READ  ERROR  (DATA  BLOCK  NOT  PRESENT) 


The  header  block  for  a  given  track  and  sector  passed  the  previous  five  tests  with  flying 
colors.  The  FDC  found  the  data  block  sync  mark  and  read  the  next  325  GCR  bytes  into 
RAM.  These  GCR  bytes  were  converted  back  into  260  8-bit  binary  bytes.  The  first  decod- 
ed 8-bit  byte  was  compared  against  a  preset  data  block  identifier  at  $0047  and  failed 
to  match.  Note  this  zero  page  memory  address  normally  contains  a  $07. 

23  READ  ERROR  (CHECKSUM  ERROR  IN  DATA  BLOCK) 

An  independent  checksum  was  calculated  for  the  256  byte  data  block  converted  above. 
This  checksum  did  not  match  the  actual  checksum  read  from  the  diskette. 


00,  OK,00,00 

Nothing  wrong  here. 

73  DOS  MISMATCH  (CBM  DOS  V2.6  1541) 

An  attempt  was  made  to  write  to  a  diskette  with  a  non-compatible  format.  The  DOS 
version  stored  at  location  $0101  was  not  a  $41.  This  memory  address  is  normally  up- 
dated during  initialization  by  reading  byte  2  from  track  18,  sector  0. 

29  READ  ERROR  (DISK  ID  MISMATCH) 

Same  as  29  READ  ERROR  above  but  conflicting  id's  were  found  during  a  write  at- 
tempt rather  than  a  read.  Repeated  occurrance  of  this  error  on  a  standard  diskette  is 
indicative  of  a  seating  problem  or  a  slow-burning  alignment  problem. 

26  WRITE  PROTECT  ON 

An  attempt  was  made  to  write  to  a  diskette  while  the  write  protect  switch  is  depress- 
ed. Remove  the  write  protect  tab  from  the  write  protect  notch. 

25  WRITE-VERIFY  ERROR 

The  contents  of  the  data  just  written  to  a  sector  did  not  match  the  data  in  RAM  when 
they  were  read  back.  This  was  probably  caused  by  a  flaw  on  the  surface  of  the  diskette. 
The  end  result  was  an  unclosed  file.  Validate  the  diskette  to  decorrupt  the  BAM.  (See 
Chapter  2.) 

00,  OK,00,00 

Looking  good. 


121 



---
Additional information can be found by searching:
- "dos_error_tables" which expands on error code table mapping to messages
- "interrogate_track_tools" which expands on how utilities use FDC error codes to analyze protection
