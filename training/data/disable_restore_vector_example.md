# Modify NMI Vector in RAM to Change RESTORE Behavior

**Summary:** Demonstrates how to modify the Non-Maskable Interrupt (NMI) vector in RAM at addresses $0318 and $0319 to alter the behavior of the RESTORE key on the Commodore 64. Provides assembly code examples to disable and restore the default NMI handling. Notes that modifying this vector affects all NMI sources, including those used for RS-232 I/O.

**Explanation**

The Commodore 64 utilizes a vector at memory locations $0318 (low byte) and $0319 (high byte) to determine the address of the routine executed when an NMI occurs. By default, this vector points to the address $FE47, which handles NMI events such as the RESTORE key press and RS-232 I/O operations.

- **Default NMI Vector:**
  - Low byte ($0318): $47
  - High byte ($0319): $FE
  - Combined address: $FE47

([devili.iki.fi](https://www.devili.iki.fi/Computers/Commodore/C64/Programmers_Reference/Chapter_5/page_311.html?utm_source=openai))

To disable the default NMI handling, you can change the low byte at $0318 to point to a routine that simply returns from the interrupt (RTI). For example, setting $0318 to $C1 will redirect the NMI vector to an RTI instruction located at $FEC1.

**Caveats:**

- Modifying the NMI vector affects all NMI sources, not just the RESTORE key. This includes NMIs generated by CIA #2, which are used for RS-232 I/O operations.
- Ensure that any custom NMI routine properly handles all potential NMI sources to maintain system stability.

## Source Code

```asm
; Disable NMI/RESTORE action by redirecting NMI vector to RTI instruction
LDA #$C1        ; Low byte of address $FEC1
STA $0318       ; Store at NMI vector low byte
LDA #$FE        ; High byte remains unchanged
STA $0319       ; Store at NMI vector high byte

; Restore original NMI vector
LDA #$47        ; Original low byte of NMI vector
STA $0318       ; Restore at NMI vector low byte
LDA #$FE        ; Original high byte of NMI vector
STA $0319       ; Restore at NMI vector high byte
```

## Key Registers

- **$0318**: Low byte of the NMI vector
- **$0319**: High byte of the NMI vector

## References

- ([devili.iki.fi](https://www.devili.iki.fi/Computers/Commodore/C64/Programmers_Reference/Chapter_5/page_311.html?utm_source=openai))