# SID 6581/8580 — Noise Waveform (LFSR)

**Summary:** The Noise waveform on the SID (6581/8580) is generated by a 23-bit Linear Feedback Shift Register (LFSR). The voice frequency registers ($D400-based) control the LFSR shift rate, where a higher frequency results in a brighter noise. Selecting the Noise waveform simultaneously with other waveforms can lock the LFSR, producing silence. Recovery involves using the TEST bit in the control register.

**Noise (23-bit LFSR)**
- The SID noise generator utilizes a 23-bit LFSR to produce pseudo-random noise.
- The voice frequency registers (FREQ LO/HI) determine the LFSR shift rate:
  - Higher frequency → faster LFSR shifts → brighter noise timbre.
  - Lower frequency → slower LFSR shifts → deeper noise timbre.
- Common applications include percussion (e.g., snare, kick), explosions, wind, hand-claps (often via filtered noise), and other sound effects.
- **Caution:** Enabling the Noise waveform concurrently with another waveform can cause the LFSR to lock, resulting in silence. This issue arises because the combined waveform selection can drive the LFSR into a state where it produces no output. ([en.wikipedia.org](https://en.wikipedia.org/wiki/MOS_Technology_6581?utm_source=openai))

**LFSR Lockup Recovery Procedure**
To recover from an LFSR lockup:
1. **Set the TEST bit:** Write to the control register with the TEST bit set to 1. This action injects a '1' into the LFSR, reinitializing it. ([en.wikipedia.org](https://en.wikipedia.org/wiki/MOS_Technology_6581?utm_source=openai))
2. **Clear the TEST bit and select the desired waveform:** Write to the control register with the TEST bit cleared (0) and the desired waveform bit(s) set.

**Example Recovery Sequence:**
Assuming voice 1 control register is at $D404:
1. Write $08 to $D404 to set the TEST bit.
2. Write $80 to $D404 to select the Noise waveform (with TEST bit cleared).

**Control Register Bit Map**
Each voice has a control register that selects waveforms and controls oscillator behavior. The bit layout is as follows:

- **Bit 7 (NOISE):** Set to 1 to enable the Noise waveform.
- **Bit 6 (PULSE):** Set to 1 to enable the Pulse waveform.
- **Bit 5 (SAW):** Set to 1 to enable the Sawtooth waveform.
- **Bit 4 (TRI):** Set to 1 to enable the Triangle waveform.
- **Bit 3 (TEST):** Set to 1 to reset the oscillator and LFSR. ([oxyron.de](https://oxyron.de/html/registers_sid.html?utm_source=openai))
- **Bit 2 (RING):** Set to 1 to enable ring modulation.
- **Bit 1 (SYNC):** Set to 1 to synchronize the oscillator with another.
- **Bit 0 (GATE):** Set to 1 to start the envelope generator.

**Note:** The TEST bit is used to reset the oscillator and LFSR. Setting this bit to 1 forces the oscillator to its initial state. ([oxyron.de](https://oxyron.de/html/registers_sid.html?utm_source=openai))

## Key Registers
- **$D400-$D406:** Voice 1 registers (FREQ LO/HI, PW LO/HI, CONTROL, ADSR)
- **$D407-$D40D:** Voice 2 registers (FREQ LO/HI, PW LO/HI, CONTROL, ADSR)
- **$D40E-$D414:** Voice 3 registers (FREQ LO/HI, PW LO/HI, CONTROL, ADSR)
- **$D415-$D418:** Filter and global control registers

## References
- "known_quirks" — expands on noise LFSR lockup and recovery
- "sound_effect_hand_clap" — expands on using filtered noise for hand clap

## Labels
- NOISE
- PULSE
- SAW
- TRI
- TEST
- RING
- SYNC
- GATE
