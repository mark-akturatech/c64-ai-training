# SID Sound Chip $D400-$D7FF
# Source: Mapping the Commodore 64

54272-54273 ($D400-$D401)
Voice 1 Frequency Control

Together, these two locations control the frequency or pitch of the
musical output of voice 1.  Some frequency must be selected in order
for voice 1 to be heard.  This frequency may be changed in the middle
of a note to achieve special effects.  The 16-bit range of the
Frequency Control Register covers over eight full octaves, and allows
you to vary the pitch from 0 (very low) to about 4000 Hz (very high),
in 65536 steps.  The exact frequency of the output can be determined
by the equation

FREQUENCY=(REGISTER VALUE*CLOCK/16777216)Hz

where CLOCK equals the system clock frequency, 1022730 for American
(NTSC) systems, 985250 for European (PAL), and REGISTER VALUE is the
combined value of these frequency registers.  That combined value
equals the value of the low byte plus 256 times the value of the high
byte.  Using the American (NTSC) clock value, the equation works out
to

FREQUENCY=REGISTER VALUE*.060959458 Hz

54272         $D400          FRELO1
Voice 1 Frequency Control (low byte)

54273         $D401          FREHI1
Voice 1 Frequency Control (high byte)

Location Range: 54274-54275 ($D402-$D403)
Voice 1 Pulse Waveform Width Control

As you will see below under the description of the Control Register at
54276 ($D404), you can select one of four different waveforms for the
output of each voice.  If the pulse waveform is selected, these
registers must be set to establish the pulse width.

The pulse width has a 12-bit resolution, being made up of the value in
the first register and the value in the lower nybble of the second
register.  The pulse width determines the duty cycle, or proportion of
the time that the rectangular wave will stay at the high part of the
cycle.

The following formula shows the relationship between the value in the
Pulse Width Register and the proportion of time that the wave stays at
the high part of the cycle:

PULSE WIDTH=(REGISTER VALUE/40.95)%

The possible range of the register values (0-4095) covers the range of
the duty cycles from 0 to 100 percent in 4096 steps.  Changing the
pulse width will vastly change the sound created with the pulse
waveform.

54274         $D402          PWLO1
Voice 1 Pulse Waveform Width (low byte)

54275         $D403          PWHI1
Voice 1 Pulse Waveform Width (high nybble)

54276         $D404          VCREG1
Voice 1 Control Register

Bit 0:  Gate Bit:  1=Start attack/decay/sustain, 0=Start release
Bit 1:  Sync Bit:  1=Synchronize Oscillator with Oscillator 3 frequency
Bit 2:  Ring Modulation:  1=Ring modulate Oscillators 1 and 3
Bit 3:  Test Bit:  1=Disable Oscillator 1
Bit 4:  Select triangle waveform
Bit 5:  Select sawtooth waveform
Bit 6:  Select pulse waveform
Bit 7:  Select random noise waveform


Bit 0.  Bit 0 is used to gate the sound.  Setting this bit to a 1
while selecting one of the four waveforms will start the
attack/decay/sustain part of the cycle.  Setting this bit back to 0
(while keeping the same waveform setting) anytime after a note has
started playing will begin the release cycle of the note.  Of course,
in order for the gate bit to have an effect, the frequency and
attack/decay/sustain/release (ADSR) registers must be set, as well as
the pulse width, if necessary, and the volume control set to a nonzero
value.

Bit 1.  This bit is used to synchronize the fundamental frequency of
Oscillator 1 with the fundamental frequency of Oscillator 3, allowing
you to create a wide range of complex harmonic structures from voice
1.  Synchronization occurs when this bit is set to 1.  Oscillator 3
must be set to some frequency other than zero, but no other voice 3
parameters will affect the output from voice 1.

Bit 2.  When Bit 2 is set to 1, the triangle waveform output of voice
1 is replaced with a ring modulated combination of Oscillators 1 and
3.  This ring modulation produces nonharmonic overtone structures that
are useful for creating bell or gong effects.

Bit 3.  Bit 3 is the test bit.  When set to 1, it disables the output
of the oscillator.  This can be useful in generating very complex
waveforms (even speech synthesis) under software control.

Bit 4.  When set to 1, Bit 4 selects the triangle waveform output of
Oscillator 1.  Bit 0 must also be set for the note to be sounded.

Bit 5.  This bit selects the sawtooth waveform when set to 1.  Bit 0
must also be set for the sound to begin.

Bit 6.  Bit 6 chooses the pulse waveform when set to 1.  The harmonic
content of sound produced using this waveform may be varied using the
Pulse Width Registers.  Bit 0 must be set to begin the sound.

Bit 7.  When Bit 7 is set to 1, the noise output waveform for
Oscillator 1 is set.  This creates a random sound output whose
waveform varies with a frequency proportionate to that of Oscillator
1.  It can be used to imitate the sound of explosions, drums, and
other unpitched noises.

One of the four waveforms must be chosed in order to create a sound.
Setting more than one of these bits will result in a logical ANDing of
the waveforms.  Particularly, the combination of the noise waveform
and another is not recommended.

Location Range: 54277-54278 ($D405-$D406)
Voice 1 Envelop (ADSR) Control

When a note is played on a musical instrument, the volume does not
suddenly rise to a peak and then cut off to zero.  Rather, the volume
builds to a peak, levels off to an intermediate value, and then fades
away.  This creates what is known as a volume envelope.

The first phase of the envelope, in which the volume builds to a peak,
is known as the attack phase.  The second, in which it declines to an
intermediate level, is called the decay phase.  The third, in which
the intermediate leve of volume is held, is known as the sustain
period.  The final interval, in which the sound fades away, is called
the release part of the cycle.

The SID chip allows the volume envelope of each voice to be
controlled, so that specific instruments may be imitated, or new
sounds created.  This is done via the attack/decay and sustain/release
registers.  Each register devotes four bits (which can store a number
from 0 to 15) to each phase of the cycle.  When a note is gated by
writing a 1 to a waveform bit and to Bit 0 of the Control Register,
the attack cycle begins.

The volume of the sound builds to a peak over the period of time
specified by the high nybble of the attack/decay register.  Once it
has reached the peak volume, it falls to the intermediate level during
the period indicated by the low nybble of the attack/decay register
(this is the decay phase).  The volume of this intermediate or sustain
level is selected by placing a value in the high nybble of the
sustain/release register.  This volume level is held until a 0 is
written to the gate bit of the control register (while leaving the
waveform bit set).  When that happens, the release phase begins, and
the volume of the sound begins to taper off during the period
indicated by the low nybble of the sustain/release register.

You may notice the volume of the sound does not quite get to 0 at the
end of the release cycle, and you may need to turn off the sound to
get rid of the residual noise.  You can do this either by setting the
waveform bit back to 0, changing the frequency to 0, or setting the
volume to 0.

54277         $D405          ATDCY1
Voice 1 Attack/Decay Register

Bits 0-3:  Select decay cycle duration (0-15)
Bits 4-7:  Select attack cycle duration (0-15)

Bits 4-7 control the duration of the attack cycle.  This is the period
of time over which the volume will rise from 0 to its peak amplitude.
There are 16 durations which may be selected.  The way in which the
number placed here corresponds to the elapsed time of this cycle is as
follows:

0 = 2 milliseconds           8 = 100 milliseconds
1 = 8 milliseconds           9 = 250 milliseconds
2 = 16 milliseconds         10 = 500 milliseconds
3 = 24 milliseconds         11 = 800 milliseconds
4 = 38 milliseconds         12 = 1 second
5 = 56 milliseconds         13 = 3 seconds
6 = 68 milliseconds         14 = 5 seconds
7 = 80 milliseconds         15 = 8 seconds

Bits 0-3 control the length of the decay phase, in which the volume of
the note declines from the peak reached in the attack phase to the
sustain level.  The number selected corresponds to the length of this
phase as shown below:

0 = 6 milliseconds           8 = 300 milliseconds
1 = 24 milliseconds          9 = 750 milliseconds
2 = 48 milliseconds         10 = 1.5 seconds
3 = 72 milliseconds         11 = 2.4 seconds
4 = 114 milliseconds        12 = 3 seconds
5 = 168 milliseconds        13 = 9 seconds
6 = 204 milliseconds        14 = 15 seconds
7 = 240 milliseconds        15 = 24 seconds

Since the two functions share one register, you must multiply the
attack value by 16 and add it to the decay value in order to come up
with the number to be placed in the register:

REGISTER VALUE=(ATTACK*16)+DECAY

54278         $D406          SUREL1
Voice 1 Sustain/Release Control Register

Bits 0-3:  Select release cycle duration (0-15)
Bits 4-7:  Select sustain volume level (0-15)

Bits 4-7 select the volume level at which the note is sustained.
Following the decay cycle, the volume of the output of voice 1 will
remain at the selected sustain level as long as the gate bit of the
Control Register is set to 1.  The sustain values range from 0, which
chooses no volume, to 15, which sets the output of voice 1 equal to
the peak volume achieved during the attack cycle.

Bits 0-3 determine the length of the release cycle.  This phase, in
which the volume fades from the sustain level to near zero volume,
begins when the gate bit of the Control Register is set to 0 (while
leaving the waveform setting that was previously chosen).  The
duration of this decline in volume corresponds to the number (0-15)
selected in the same way as for the decay value:

0 = 6 milliseconds           8 = 300 milliseconds
1 = 24 milliseconds          9 = 750 milliseconds
2 = 48 milliseconds         10 = 1.5 seconds
3 = 72 milliseconds         11 = 2.4 seconds
4 = 114 milliseconds        12 = 3 seconds
5 = 168 milliseconds        13 = 9 seconds
6 = 204 milliseconds        14 = 15 seconds
7 = 240 milliseconds        15 = 24 seconds

Location Range: 54279-54292 ($D407-$D414)
Voice 2 and Voice 3 Controls

The various control registers for these two voices correspond almost
exactly to those of voice 1.  The one exception is that the sync and
ring-modulation bits of voice 2 operate on Oscillators 1 and 2, while
the same bits of the Control Register for voice 3 uses Oscillators 2
and 3.

54279         $D407          FRELO2
Voice 2 Frequency Control (low byte)

54280         $D408          FREHI2
Voice 2 Frequency Control (high byte)

54281         $D409          PWLO2
Voice 2 Pulse Waveform Width (low byte)

54282         $D40A          PWHI2
Voice 2 Pulse Waveform Width (high nybble)

54283         $D40B          VCREG2
Voice 2 Control Register

Bit 0:  Gate Bit:  1=Start attack/decay/sustain, 0=Start release
Bit 1:  Sync Bit:  1=Synchronize oscillator with Oscillator 1 frequency
Bit 2:  Ring Modulation:  1=Ring modulate Oscillators 2 and 1
Bit 3:  Test Bit:  1=Disable Oscillator 2
Bit 4:  Select triangle waveform
Bit 5:  Select sawtooth waveform
Bit 6:  Select pulse waveform
Bit 7:  Select noise waveform

54284         $D40C          ATDCY2
Voice 2 Attack/Decay Register

Bits 0-3:  Select decay cycle duration (0-15)
Bits 4-7:  Select attack cycle duration (0-15)

54285         $D40D          SUREL2
Voice 2 Sustain/Release Control Register

Bits 0-3:  Select release cycle duration (0-15)
Bits 4-7:  Select sustain volume level (0-15)

54286         $D40E          FRELO3
Voice 3 Frequency Control (low byte)

54287         $D40F          FREHI3
Voice 3 Frequency Control (high byte)

54288         $D410          PWLO3
Voice 3 Pulse Waveform Width (low byte)

54289         $D411          PWHI3
Voice 3 Pulse Waveform Width (high nybble)

54290         $D412          VCREG3
Voice 3 Control Register

Bit 0:  Gate Bit:  1=Start attack/decay/sustain, 0=Start release
Bit 1:  Sync Bit:  1=Synchronize oscillator with Oscillator 2 frequency
Bit 2:  Ring Modulation:  1=Ring modulate Oscillators 3 and 2
Bit 3:  Test Bit:  1=Disable Oscillator 3
Bit 4:  Select triangle waveform
Bit 5:  Select sawtooth waveform
Bit 6:  Select pulse waveform
Bit 7:  Select noise waveform

54291         $D413          ATDCY3
Voice 3 Attack/Decay Register

Bits 0-3:  Select decay cycle duration (0-15)
Bits 4-7:  Select attack cycle duration (0-15)

54292         $D414          SUREL3
Voice 3 Sustain/Release Control Register

Bits 0-3:  Select release cycle duration (0-15)
Bits 4-7:  Select sustain volume level (0-15)

Location Range: 54293-54296 ($D415-$D418)
Filter Controls

In addition to the controls detailed above for each voice, the SID
chip also provides a filtering capability which allows you to
attenuate (make quieter) certain ranges of frequencies.  Any one or
all three voices can be filtered, and there is even a provision for
filtering an external signal that is input through pin 5 of the
monitor jack.

A low-pass filter is available, which suppresses the volume of those
frequency components that are above a designated cutoff level.  The
high-pass filter reduces the volume of frequency components that are
below a certain level.  The band-pass filter reduces the volume of
frequency components on both sides of the chosen frequency, thereby
enhancing that frequency.  Finally, the high-pass and low-pass filters
can be combined to form a notch reject filter, which reduces the
folume of the frequency components nearest the selected frequency.
These various filters can dramatically change the quality of the sound
produced.

The first two registers are used to select the filter cutoff
frequency.  This is the frequency above or below which any sounds will
be made quieter.  The further away from this level any frequency
components are, the more their output volume will be suppresed (high-
and low-pass filters reduce the volume of those components by 12 dB
per octave away from the center frequency, while the band-pass filter
attenuates them by 6 dB per octave).

The cutoff frequency has an 11-bit range (which corresponds to the
numbers 0 to 2047).  This is made up of a high-byte and three low
bits.  Therefore, to compute the frequency represented by the value in
these registers, you must multiply the value in the high byte by 8,
and add the value of the low three bits.  The range of cutoff
freqnencies represented by these 2048 values stretches from 30 Hz to
about 12,000 Hz.  The exact frequency may be calculated with the
formula:

FREQUENCY=(REGISTER VALUE*5.8)+30Hz

An additional element in filtering is the resonance control.  This
allows you to peak the volume of the frequency elements nearest the
cutoff frequency.

