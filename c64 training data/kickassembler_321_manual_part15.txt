# KickAssembler - Binary/SID Import, Graphics Conversion

To make the assembled machine code run on a C64 or in an emulator, it’s useful to include a little
basic program that starts your code (for example: 10 sys 4096). The BasicUpstart macro is standard
macro that helps you to create programs like that. The following program shows how it’s used:
   .pc = $0801 "Basic Upstart"
   :BasicUpstart(start)           // 10 sys$0810
   .pc =$0810 "Program"
   start:
            inc $d020
            inc $d021
            jmp start
TIP: Insert at basic upstart program in the start of your programs and use the –execute option to
start Vice. This will automatically load and execute your program in Vice after successful
assembling.
There is a second variation of the basic upstart macro that also takes care of setting up memory
blocks:
   :BasicUpstart2(start)           // 10 sys$0810
   start:
            inc $d020
            inc $d021
            jmp start
If you want to see the script code for the macros, you can look in the autoinclude.asm file in the
KickAss.jar file.
9.2 Opcode Constants
When making self modifying code or code that unrolls speed code, you have to know the value of
the opcodes involved. To make this easier, all the opcodes have been given their own constant. The
constant is found by writing the mnemonic in uppercase and appending the addressing mode. For
example, the constant for a rts command is RTS and ‘lda #0’ is LDA_IMM. So, to place an rts
command at target you write:
   lda #RTS
   sta target
                                                                                                   41
You get the size of a mnemonic by using the asmCommandSize command
  .var rtsSize = asmCommandSize(RTS)                 //rtsSize=1
  .var ldaSize1 = asmCommandSize(LDA_IMM)            //ldaSize1=2
  .var ldaSize2 = asmCommandSize(LDA_ABS)            //ldaSize2=3
Here are a list of the addressing modes and example constants:
Argument Description                Example constant Example command
              None                  RTS                rts
IMM           Immediate             LDA_IMM            lda #$30
ZP            Zeropage              LDA_ZP             lda $30
ZPX           Zeropage,x            LDA_ZPX            lda $30,x
ZPY           Zeropage,y            LDX_ZPY            ldx $30,y
IZPX          Indirect zeropage,x   LDA_IZPX           lda ($30,x)
IZPY          Indirect zeropage,y   LDA_IZPY           lda ($30),y
ABS           Absolute              LDA_ABS            lda $1000
ABSX          Absolute,x            LDA_ABSX           lda $1000,x
ABSY          Absolute,y            LDA_ABSY           lda $1000,y
IND           Indirect              JMP_IND            jmp ($1000)
REL           Relative              BNE_REL            bne loop
9.3 Colour Constants
Kick Assembler has build in the C64 colour constants:
Constant                           Value
BLACK                              0
WHITE                              1
RED                                2
CYAN                               3
PURPLE                             4
GREEN                              5
BLUE                               6
YELLOW                             7
ORANGE                             8
BROWN                              9
LIGHT_RED                          10
DARK_GRAY/DARK_GREY                11
GRAY/GREY                          12
LIGHT_GREEN                        13
LIGHT_BLUE                         14
LIGHT_GRAY/LIGHT_GREY              15
                                                                     42
Example of use:
           lda #BLACK
           sta $d020
           lda #WHITE
           sta $d021
9.4 Exporting Labels
By using the –symbolfile option at the commandline it’s possible export all the assembled symbols.
The line
   java –jar KickAss.jar source1.asm -symbolfile
will generate the file source1.sym while assembling. Lets say the content of source1 is:
   .filenamespace source1
   .pc =$2000
   clearColor:
           lda #0
           sta $d020
           sta $d021
           rts
The content of source1.sym will be:
   .namespace source1 {
           .label clearColor = $2000
   }
It’s now possible to refer to the labels of source1.asm from another file just by importing the .sym
file:
   .import source “source1.sym”
   jsr source1.clearColor
Another way of exporting labels is the –vicesymbols option that exports the label to a .vs file that
can be read by the VICE emulator.
9.5 Import of Binary Files
It’s possible to load any file into a variable. This is done with the LoadBinary function. To extract
bytes of the file from the variable you use the get function. You can also get the size of the file with
the getSize function. Here is an example
   // Load the file into the variable ’data’
   .var data = LoadBinary("myDataFile")
   // Dump the data to the memory
   myData: .fill data.getSize(), data.get(i)
When you know the format of the file, you can supply a template string that describes the memory
blocks. Each block is given a name and a start address relative to the start of the file. When you
                                                                                                      43
supply a template to the LoadBinary function, the returned value will contain a get and a size
function for each memory block:
   .var dataTemplate = "XCoord=0,YCoord=$100, BounceData=$200"
   .var file = LoadBinary("moveData", dataTemplate)
   XCoord: .fill file.getXCoordSize(), file.getXCoord(i)
   YCoord: .fill file.getYCoordSize(), file.getYCoord(i)
   BounceData: .fill file.getBounceDataSize(), file.getBounceData(i)
There is a special template tag named ‘C64FILE' that is used to load native c64 files. When this is
in the template string, the LoadBinary function will ignore the two first byte of the file, since the
first two bytes of a C64 file are used to tell the loader the start address of the file. Here is an
example of how to load and display a Koala Paint picture file:
   .const KOALA_TEMPLATE = "C64FILE, Bitmap=$0000, ScreenRam=$1f40, ColorRam=$2328,
                                                                          BackgroundColor = $2710"
   .var picture = LoadBinary("picture.prg", KOALA_TEMPLATE)
   .pc = $0801 "Basic Program"
   :BasicUpstart($0810)
   .pc =$0810 "Program"
           lda #$38
           sta $d018
           lda #$d8
           sta $d016
           lda #$3b
           sta $d011
           lda #0
           sta $d020
           lda #picture.getBackgroundColor()
           sta $d021
           ldx #0
   !loop:
           .for (var i=0; i<4; i++) {
              lda colorRam+i*$100,x
              sta $d800+i*$100,x
           }
